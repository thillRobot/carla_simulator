# Information Page for custom CARLA map: Campus02

## General Information 
map name: CoE04 (College of Engineering 03)
date created: August 04, 2021

intended package: TNTech???

### Map Bounding Box Latitude and Longitude

This bounding box covers the center of TNTech campus including Derryberry Hall and the RUC. This map has terrain and a stoplight. Also, this should be a good place to test pedestrain traffic. 

min lat (S):  36.17377
min lat (S):  36.17772
min lat (S): -85.50643
min lat (S): -85.50248


### Origin


??? - This will be set in RoadRunner I think 

## Data Sources

### OpenStreetMap Data (.osm)

JOSM version 18118 (josm-tested.jar) was used to download the OpenStreetMap data and save it as single layer .osm file.

OSM File: `maps/Campus02/Campus02.osm` 


### Elevation Data 

Digital elevation model (DEM) was downloaded from http://www.tngis.org/lidar

Campus spans DEM tiles#: 2108661NE 2108661NW 2108661SW 2108661SE

QGIS was used to combine tiles and convert elevation to meters.

DEM File: `carla_maps/large_tifs/2108661_2108669_2108653_meters.tif`

minimumHeight=  m
maximumHeight=  m


## Conversion for CARLA

### Prepare OSM file with projection workaround from JHMeusener (https://github.com/JHMeusener/CarlaSimpleXODRProjectionWorkaround).

I cloned this package to `~/tools/CarlaSimpleXODRProjectionWorkaround`, and I created a virtual environment to run the workaround. I edited the paths to the input and output files before running the script `main.py`.

```
...

osmPath = '/home/$USER/carla_simulator/maps/Campus02/Campus02.osm'
...

```


```
cd ~/tool/CarlaSimpleXODRProjectionWorkaround
source waenv/bin/activate

python main.py

```
The following files were generated by the script.

- `/home/******/carla_simulator/maps/Campus02/map_modified_for_Carla.osm`
- `/home/******/carla_simulator/maps/Campus02/replace_XodrHeader_with_this.txt`

Followings Jan's instructions, copy the text from 

### Convert the prepared .osm to with .xodr with `convert_osm_xodr.py` from CARLA

I edited the paths in the script. Notice they have the strange directory backouts similar to above, but there must be a better way, this is discussed in maps.md and issues.md.
```
...

f = open("../../../maps/Campus02/Campus02.osm", 'r')

...

f = open("../../../maps/Campus02/Campus02_CARLA.xodr", 'w')

```

Run the script.
```

cd ~/carla_simulator/carla/PythonAPI/carla
python3 ../util/convert_osm_xodr.py 

Warning: Discarding unknown compound 'cycleway.lane' in type 'cycleway.lane|cycleway.lane|highway.residential' (first occurence for edge '574210687').
Warning: Discarding unknown compound 'cycleway.lane' in type 'cycleway.lane|cycleway.lane|highway.residential' (first occurence for edge '574210687').
Warning: Could not write OpenDRIVE geoReference. Only unshifted Coordinate systems are supported (offset=7684531.66,-4019034.71)
```

The file `Campus02_CARLA.xodr` has been generated.


## QGIS
CRS: [EPSG:4326]
clipping 

road runner projection settings:

World:

XODR file:

OSM file:

XODR -> OSM offset correction. Applied in Road runner
x:
y:


files to be ingested into carla

map CoE04 is in package TNTech04
